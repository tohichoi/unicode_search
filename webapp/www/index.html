<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <link href="../css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="../css/bootstrap-icons-1.10.3/bootstrap-icons.css">
  <link href="../css/index.css" rel="stylesheet" crossorigin="anonymous">
  <script src="../lib/popper.js"></script>
  <script src="../lib/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="../lib/masonry.pkgd.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans">
  <title>Unicode search</title>
</head>
<body>
  <div class="container-fluid">
    <h1 class="text-center mt-3">
      <a href="https://home.unicode.org/" target="_blank"><img src="../image/Unicode-Logo-Final-Blue-95x112.jpg" width="35px"/></a>
      Unicode search
    </h1>
    <div class="row mb-3 justify-content-center">
      <div class="col-6">
        <input class="form-control form-control-lg" type="text" id="id_search_text"/>
      </div>
      <div class="col-auto">
        <button type="button" class="btn form-control form-control-lg" data-bs-toggle="modal" data-bs-target="#id_settings">
          <i class="bi bi-gear-fill"></i>
        </button>
      </div>
      <!-- <div class="col-1">
        <button class="btn btn-default bi-search form-control-lg" id="id_search"></button>
      </div> -->
    </div>
    <div class="row justify-content-center">
      <div class="col-auto">
        <p id="id_search_info"></p>
      </div>
    </div>
    
    <!-- <div id="id_tooltip" role="tooltip">I'm a tooltip
      <div id="arrow" data-popper-arrow></div>
    </div>  -->
    
    <!-- masonry -->
    <div class="row mt-3 justify-content-center">
      <!-- <div class="col-1">⎗</div> -->
      <div class="grid col-auto" id="id_search_result_container" style="background-color: #ffffff;"></div>
      <!-- <div class="col-1">⎘</div> -->
    </div>
    <!-- masonry -->
    
    <div class="row mt-3 justify-content-center">
      <div class="col-auto">
        <nav aria-label="...">
          <ul class="pagination" id="id_pagination">
            <li class="page-item disabled">
              <input type="button" class="btn page-link" value="Previous"/>
            </li>
            <!-- <li class="page-item">
              <a class="page-link" href="#">1</a>
            </li>
            <li class="page-item active" aria-current="page">
              <a class="page-link" href="#">2</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">3</a>
            </li> -->
            <li class="page-item">
              <input type="button" class="btn page-link" value="Next"/>
              <!-- <a class="page-link" href="#">Next</a> -->
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="id_settings" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Settings</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="id_api_address" class="col-form-label">API address:</label>
              <input type="text" class="form-control" id="id_api_address" placeholder="http://localhost:8000">
            </div>
            <div class="alert alert-success visually-hidden" role="alert">
              Successfully connected to server
            </div>
            <div class="alert alert-danger visually-hidden" role="alert">
              Cannot connect to the server
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="id_test_settings">Test</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="id_save_settings">Save</button>
        </div>
      </div>
    </div>
  </div>
  
</body>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    function hide_modal_alert() {
      for (x of ['.alert-danger', '.alert-success'])
          document.querySelector(x).classList.add('visually-hidden');
    }

    const settings_modal = document.getElementById('id_settings');
    settings_modal.addEventListener('show.bs.modal', event => {
      // Button that triggered the modal
      const button = event.relatedTarget;

      // load saved
      let addr = window.localStorage.getItem('unicode-search.settings.api_address');
      if (!addr)
        addr = 'localhost:8000'; 
      let addr_elm = document.getElementById('id_api_address');
      addr_elm.value = addr;
      addr_elm.focus = true;

      // test
      document.getElementById('id_test_settings').onclick = (event) => {
        hide_modal_alert();

        fetch(addr_elm.value.trim())
        .then((response) => {
            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.statusText}`);
            }
            document.querySelector('.alert-success').classList.remove('visually-hidden');
        })
        .catch((error) => {
          document.querySelector('.alert-danger').classList.remove('visually-hidden');
        });
      };

      // save
      document.getElementById('id_save_settings').onclick = (event) => {
        console.log(addr_elm.value.trim());
        window.localStorage.setItem('unicode-search.settings.api_address', addr_elm.value.trim());
      };
    });

    settings_modal.addEventListener('hidden.bs.modal', event => {
      hide_modal_alert();
    });

    import("./js/renderer.js").then((module) => {
      // console.log(`${module} is loaded.`);
      let renderer = new module.Renderer()
      renderer.init({
        'elements' : {
          'result_view' : 'id_search_result_container',
          'search' : 'id_search',
          'search_text' : 'id_search_text',
          'search_info' : 'id_search_info',
          'pagination' : 'id_pagination',
        },
        'storage' : {
          'api_address': 'unicode-search.settings.api_address'
        }
      });
      renderer.load_data(null);
    });
  });
</script>

</html>